unclassified:
  ansibleProjects:
    projects:
      - id: "ansible"
        repository: "https://github.com/hadamrd/ansible"
        defaultBranch: "main"
        execEnv: "local/ansible:slim"
        envGroups:
          - groupName: "production"
            inventoryPathTemplate: "inventory/prod"
            vaultIds: ["prod"]
        ansibleConfig: "${readFile:src/test/resources/jenkins-config/ansible/ansible.cfg}"
        vaults:
          - id: "prod"
            credentialId: "prod-ansible-key"
  environmentACL:
    aclRules:
      - name: "sre-dev-release-access"
        type: "allow"
        priority: 300
        jobs: ["*"]
        environmentGroups: ["production"]
        users: ["sre"]
    environmentGroups:
      - name: "production"
        description: "Production environments"
        sshCredentialId: "prod-ssh-key"
        environments:
          - "prod-eu"
        nodeLabels:
          - "agent"
        tags:
          - "production"
          - "critical"
  pulsarDeployments:
    jobs:
      - id: "ping-vm"
        name: "Ping an environment"
        category: "Utilities"
        templateName: "ping"
        params:
          - name: ref
            value: "main"
    templates:
      - name: "ping"
        description: "Ping an environment"
        params:
          - name: "environment"
            type: "environment"
            description: "Target environment"
          - name: "ref"
            type: "ansibleProjectRef"
            description: "Select ansible project ref"
            properties:
              - name: "projectId"
                value: "ansible"
        script: |
          node(deployParams.nodeLabels) {
            ansibleProject(projectId: 'ansible', ref: deployParams.ref) {
              ansiblePlaybook(
                user: 'ansible',
                playbook: 'playbooks/ping.yml',
                envName: deployParams.environment
              )
            }
          }
