jobs:
  - script: >
      pipelineJob('ansible-job') {
        parameters {
          environmentChoice {
            name 'environment'
            description 'Select the target environment'
          }
          ansibleProjectBranch {
            name 'branch'
            description 'Select branch'
            projectId 'ansible'
          }
        }
        definition {
          cps {
            script('''
              node('dev') {
                ansibleProject(projectId: 'ansible', version: [ref: params.branch, type: 'branch'], cleanup: false) {
                    ansiblePlaybook(
                        user: 'ansible',
                        playbook: 'playbooks/ping.yml',
                        envName: params.environment
                    )
                }
              }
            '''.stripIndent())
            sandbox()
          }
        }
      }