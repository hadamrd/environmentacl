jobs:
  - script: >
      pipelineJob('ansible-job') {
        parameters {
          environmentChoice {
            name 'environment'
            description 'Select the target environment'
          }
          ansibleProjectRef {
            name 'ref'
            description 'Select ansible project ref'
            projectId 'ansible'
          }
        }
        definition {
          cps {
            script('''
            node('dev') {
              ansibleProject(projectId: 'ansible', ref: params.ref, cleanup: false) {
                  ansiblePlaybook(
                      user: 'ansible',
                      playbook: 'playbooks/ping.yml',
                      envName: params.environment
                  )
              }
            }'''.stripIndent())
            sandbox()
          }
        }
      }